---
title: "[99클럽] 면접반 2일차"
tags:
  - 면접
image: ./assets/banner.png
date: 2025-04-10 10:08:27
series: 면접
draft: false
---

![배너 이미지](./assets/banner.png)

> 📖 질문
>
> 마이크로서비스 데이터 일관성
>
> 마이크로서비스 혹은 분산 시스템에서 데이터 일관성을 유지하기 위한 전략을 고민하거나 적용한 경험이 있다면 공유해주세요. 규모가 작아도 서비스 간 데이터 처리 흐름을 설계해본 경험이면 충분합니다.
>
> 힌트: 단일 DB 트랜잭션이 아닌, 서비스 간 데이터 일관성을 유지하는 방식을 고민해본 경험을 떠올려 보세요. (예: Eventual Consistency, 이벤트 기반 처리, SAGA 패턴 등)

## 답변

안녕하세요. 솔직히 말씀드리면 마이크로서비스 아키텍쳐를 직접 구현해본 경험은 없습니다. 하지만 제가 사내 인트라넷 프로젝트에서 서로 다른 언어, 프레임워크로 개발된 사내 여러 시스템 간에 JWT 기반 통합 인증 시스템을 구축한 경험이 있는데, 이 과정에서 분산 환경에서의 데이터 일관성 문제를 다뤄본 적이 있습니다.

저희 회사 인트라넷은 Java + Spring Boot로 개발된 회의실 예약 시스템, Node.js 기반 사내 임직원 현황판, PHP로 만들어진 데이터 플랫폼등 여러 웹 어플리케이션이 공존했습니다. 각 시스템은 독립적으로 개발되었지만, 사용자 정보 및 인증, 권한 관리는 일관되게 유지해야 했습니다.

이 과정에서 직면한 주요 문제는 사용자 정보 변경(ex. 팀 변경, 권한 변경...)이 발생했을 때 모든 시스템에 일관되게 반영하는 것이었습니다. 단일 DB 트랜잭션 만으로는 해결할 수 없는 상황이였습니다. 그래서 생각해본 결과 제가 접근한 방식은 이벤트 기반 처리 방식이였습니다.

- 이벤트 발생/구독 모델 도입: 중앙 인증 서비스에서 사용자 정보 변경이 발생하면 이벤트를 발행하고 각 서비스는 이 이벤트를 구독해 자체 DB를 업데이트 하도록 했습니다. 메세지 브로커로는 RabbitMQ를 이용했습니다.

- 일관성 접근: 모든 시스템이 즉시 동기화되지는 않았지만, 일관된 상태에 더 초점을 두었습니다. 각 서비스는 독립적으로 업데이트 되며, 임시적인 데이터 불일치가 발생할 수 있다는 점을 시스템 설계 시 고려했습니다.

- 멱등성 보장: 같은 이벤트가 여러번 전달되더라도 결과가 동일하게 설계했습니다. 이벤트 ID와 타임스탬프를 활용해 중복처리를 방지했습니다.

- 보상 트랜잭션: 문제가 발생했을 경우, 이전 상태로 되돌릴 수 있게 비즈니스 로직을 구현했습니다. 예컨데, 권한 변경이 특정 시스템에 실패를 하게 된다면 다른 시스템에도 해당 변경을 롤백 시키게 이벤트를 발행했습니다.

해당 프로젝트에서 어려웠던 부분 중 하나는 네트워크 장애나 서비스 다운타임 동안의 데이터 일관성 유지였습니다. 이를 위해 이벤트 저장소를 구현하여 모든 이벤트를 지속적으로 기록하게끔 시도를 해보았고 서비스가 복구되면 놓친 이벤트를 재처리하도록 하였습니다.

또한 해당 프로젝트에서 가장 큰 도전 중 하나는 여러 서비스 간에 일관된 사용자 인증 상태를 유지하는 것이였습니다. JWT 토큰을 이용하여 SSO와 유사하게 구현을 하였는데 해당 부분에서 몇 가지 데이터 일관성 문제가 발생하였습니다.

- 토큰 무효화 및 동기화: 사용자가 로그아웃을 시도하면 모든 서비스에서 해당 토큰이 무효화되어야 했습니다. 이를 위해 중앙 인증 서비스에서 **로그아웃 이벤트**를 발행하고 각 서비스는 이 이벤트를 수신해 해당 토큰을 블랙리스트에 추가하는 방식을 고안하고 구현했습니다. 토큰 자체를 메세지에 포함하지 않고 해시된 토큰 ID만 전달하여 보안을 조금 더 강화한 경험이 있습니다.

- 권한 변경 처리: 사용자의 역할이나 권한이 변경될 때 기존 토큰으로는 새 권한을 반영할 수 없는 문제가 있었습니다. 이 문제를 해결하기 위해 **권한 변경 이벤트**가 발생하면 해당 사용자의 모든 활성 토큰을 무효화하고 재로그인을 하게끔 요청하는 로직을 구현했습니다. 이는 완벽하게 실시간은 아니지만 권한 변경이 최대한 빠르게 반영되도록 하였습니다.

- 사용자 토큰 일관성: 여러 서비스에서 동시에 작업하는 사용자의 토큰 상태를 일관되게 유지하는 것도 중요했습니다. 이를 위해 활성 세션 정보를 Redis를 사용해 중앙에서 관리하고, 사용자가 특정 서비스에서 토큰을 갱신하면 다른 서비스에서도 이 정보가 공유되도록 구현했습니다.

이 경험을 통하여 분산 시스템에서 완벽한 일관성을 추구하기 보다는 비즈니스 요구사항에 맞는 적절한 수준의 일관성을 정의하였고, 일시적인 불일치가 발생할 수 있는 시나리오를 명확히 이해하였습니다. 또한 각 서비스가 독립적으로 작동하면서도 시스템 전체의 상태 일관성을 유지할 수 있는 이벤트 기반 아키텍처의 가치를 깊이 이해하게 되었습니다.

물론 완전한 마이크로서비스는 아니였지만 해당 경험을 통하여 분산 시스템에서 데이터 일관성을 위한 트레이드 오프와 설계 고려사항을 깊이 이해하게 되었습니다. 추가로 이 경험은 비즈니스 요구사항과 기술적 제약 사이에서 균형을 찾는 방법도 배울 수 있었던 소중한 기회였습니다.